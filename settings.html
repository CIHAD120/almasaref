<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</title>
    <link rel="stylesheet" href="assets/css/base.css">
</head>
<body>
    <div style="padding: 2rem; max-width: 600px; margin: 0 auto;">
        <div class="glass-panel" style="padding:1rem; margin-bottom:2rem; display:flex; justify-content:space-between;">
            <h3>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
            <a href="dashboard.html" class="btn">Ø¹ÙˆØ¯Ø©</a>
        </div>

        <div class="glass-panel" style="padding: 2rem;">
            <h2 style="color:var(--accent)">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„Ù„Ù…Ø¯ÙŠØ±</h2>
            <p style="color:var(--text-muted); margin-bottom:20px;">
                Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒØ§ÙØ© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ù…Ù‡Ø§Ù…ØŒ Ø«Ù… Ø£Ø±Ø³Ù„Ù‡ Ù„Ù„Ù…Ø¯ÙŠØ±.
            </p>
            <button id="exportBtn" class="btn btn-primary" style="width:100%; padding:15px;">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©)</button>
        </div>
    </div>

    <script type="module">
        import { dbInstance } from './assets/js/core/db.js';
        import { authInstance } from './assets/js/core/auth.js';
        authInstance.checkAuth();
        const user = authInstance.currentUser;

        document.getElementById('exportBtn').onclick = async () => {
            await dbInstance.connect();
            const expenses = (await dbInstance.getAll('expenses')).filter(e => e.userId === user.email);
            const tasks = (await dbInstance.getAll('tasks')).filter(t => t.userId === user.email);
            const incomes = (await dbInstance.getAll('income')).filter(i => i.userId === user.email);

            const data = { user: { name: user.name, email: user.email }, expenses, tasks, incomes };
            const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `Report_${user.name}_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        };
    </script>
</body>
</html>